<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pool League - Match History</title>
  <link rel="stylesheet" href="/styles/header.css">
  <link rel="stylesheet" href="/styles/poolLeague.css">
</head>
<body>
  <h2>
    <%- include('templates/header.ejs'); %>
  </h2>

  <h1>Pool League Match History - <%= seasonLabel %></h1>

  <div class="pool-tabs">
    <a href="/poolLeague/this-week" class="pool-tab">This Week / Playoffs</a>
    <a href="/poolLeague/history" class="pool-tab active">Match History</a>
    <a href="/poolLeague/standings" class="pool-tab">Standings / Rankings</a>
  </div>

  <form method="GET" action="/poolLeague/history" class="controls wide">
    <label for="teamId">Filter by team:</label>
    <select id="teamId" name="teamId" class="dropdown">
      <% teams.forEach(team => { %>
        <option value="<%= team._id %>" <%= String(team._id) === String(activeTeamId) ? 'selected' : '' %>><%= team.name %></option>
      <% }); %>
    </select>

    <label for="sortBy">Sort by:</label>
    <select id="sortBy" name="sortBy" class="dropdown">
      <option value="completedAt" <%= sortBy === 'completedAt' ? 'selected' : '' %>>Completed Time</option>
      <option value="matchup" <%= sortBy === 'matchup' ? 'selected' : '' %>>Matchup</option>
      <option value="winner" <%= sortBy === 'winner' ? 'selected' : '' %>>Winner</option>
    </select>

    <button type="submit" class="small-button">Apply</button>
  </form>

  <div class="history-list">
    <% if (rows.length === 0) { %>
      <p class="empty-state">No completed matches yet.</p>
    <% } %>

    <% rows.forEach(row => { %>
      <div class="history-row">
        <p><strong><%= row.matchup %></strong> (<%= row.phase %><%= row.playoffRound ? ' ' + row.playoffRound : '' %>)</p>
        <p>Score: <%= row.score %> | Winner: <%= row.winner %></p>
        <p><%= row.completedAt ? new Date(row.completedAt).toLocaleString() : '' %></p>
      </div>
    <% }); %>
  </div>
</body>
</html>
